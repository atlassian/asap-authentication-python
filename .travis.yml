sudo: false
language: python
python:
- 2.7
- 3.4
- 3.5
- &main_python_version 3.6
before_install:
- pip install -U pip setuptools
script:
- python setup.py test

jobs:
  fast_finish: true

  include:
  - stage: &lint_stage_name lint
    python: *main_python_version
    install:
    - pip install -q pep8==1.6.2
    script:
    - pep8 .

  - stage: &deploy_stage_name deploy to PYPI (triggered only for tagged commits)
    python: *main_python_version
    before_install: []
    script: skip
    deploy:
      provider: pypi
      distribution: sdist bdist_wheel
      user: dblack
      password:
        secure: YOUR_ENCRYPTED_PASSWORD_HERE_https://docs.travis-ci.com/user/encryption-keys/
      # Since commit https://github.com/travis-ci/dpl/commit/90b5e39
      # it is default that Travis PYPI provider has `skip_upload_docs: true`
      # set by default.
      on:
        tags: true
        all_branches: true

stages:
- *lint_stage_name
- test
- name: *deploy_stage_name
  if: tag IS present
